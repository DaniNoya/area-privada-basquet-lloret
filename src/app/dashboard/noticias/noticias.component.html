<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Notícias</h1>
</div>
<!-- Create new tab -->
<mat-tab-group (selectedTabChange)="editar=false;editNoticia=undefined;tipoNoticia='';msgNoticiesEmpty=false;noticiasDescargadas=[]">
  <mat-tab label="Crear">
    <div class="row mt-3">
      <!-- Select type (both) and Main photo (desktop) -->
      <div class="col-12 col-sm-12 col-md-12 col-lg-3 col-xl-3">
        <div class="row">
          <div class="col-12 col-sm-12 col-md-6 col-lg-12 col-xl-12">
            <mat-form-field>
              <mat-label><b>Tipo de Noticia:</b></mat-label>
              <mat-select [(value)]="not.tipo">
                <mat-option [value]="'noticia'">
                  Noticia
                </mat-option>
                <mat-option [value]="'cronica'">
                  Crónica
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-12 col-sm-12 col-md-6 col-lg-12 col-xl-12">
            <mat-form-field [hidden]="not.tipo != 'cronica'">
              <mat-label><b>Equipo</b></mat-label>
              <mat-select [(value)]="not.equipo">
                <mat-option *ngFor="let equipo of equipos" [value]="equipo.id">
                  {{ equipo.categoria }} {{ equipo.tipoCategoria }} {{ equipo.descripcion }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-12 d-none d-lg-block">
            <input [hidden]="true" class="mt-3" type="file" accept="image/*" #file imageUpload (imageSelected)="selected($event)" [resizeOptions]="resizeOptions"/>
            <button type="button" class="btn btn-primary mt-3 mb-3" (click)="file.click()">Seleccionar imagen de portada</button>
            <img src="{{ not.imagenPortada }}" class="max-100" />
            <div #video></div>
          </div>
        </div>
      </div>
      <!-- Title & Text editor (Both) -->
      <div class="col-12 col-sm-12 col-md-12 col-lg-9 col-xl-9">
        <div class="row">
          <mat-form-field class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-6">
            <input matInput type="text" maxlength="100" #titol placeholder="Título"/>
          </mat-form-field>
          <div class="col-12">
            <angular-editor [(ngModel)]="not.text" [config]="editorConfig"></angular-editor>
          </div>
        </div>
      </div>
      <!-- Main photo (Mobile) -->
      <div class="col-12 d-lg-none">
        <input [hidden]="true" class="mt-3" type="file" accept="image/*" #file imageUpload (imageSelected)="selected($event)" [resizeOptions]="resizeOptions"/>
        <button type="button" class="btn btn-primary mt-3 mb-3" (click)="file.click()">Seleccionar imagen de portada</button>
        <img src="{{ not.imagenPortada }}" class="max-100" />
        <div #video></div>
      </div>
      <!-- Media files for edition (Both) -->
      <div class="col-12 mb-3">
        <div class="row">
          <div class="col-12">
            <input [hidden]="true" class="mt-3" type="file" accept="image/*|video/*" #files imageUpload (imageSelected)="insertMedia($event)" [resizeOptions]="resizeOptions" multiple/>
            <button type="button" class="btn btn-primary mt-3 mb-3" (click)="files.click()">Añadir contenido adicional</button>
          </div>
          <div class="col-lg-1 col-4" *ngFor="let m of not.media">
            <button class="close" (click)="deleteImagen(m)"><i class="fas fa-times-circle"></i></button>
            <img src="{{ m.mediaURL }}" width="100%"/>
          </div>
        </div>
      </div>
      <!-- Publish on social networks (Both) -->
      <div class="col-12" [hidden]="true">
        Publicar en:<br/>
        <mat-checkbox class="ml-3" #facebook disabled="{{!appComponent.facebookApi}}" labelPosition="after">
          Facebook
        </mat-checkbox>
        <mat-checkbox class="ml-3" #instagram disabled="{{!appComponent.instagramApi}}" labelPosition="after">
          Instagram
        </mat-checkbox>
        <mat-checkbox class="ml-3" #twitter disabled="{{!appComponent.twitterApi}}" labelPosition="after">
          Twitter
        </mat-checkbox>
      </div>
      <!-- Save button only if new has main photo, title, text and type -->
      <div class="col-12">
        <button type="button" class="btn btn-success mt-3" [disabled]="not.imagenPortada === undefined || titol.value === '' || not.text === undefined || not.tipo === undefined || (not.tipo === 'cronica' && not.equipo === undefined)" (click)="save()">Guardar</button>
      </div>
    </div>
  </mat-tab>
  <!-- Edition tab -->
  <mat-tab label="Editar/Eliminar">
    <div class="row mt-3 ml-3" *ngIf="!editar">
      <mat-form-field>
        <mat-label><b>Tipo de noticia:</b></mat-label>
        <mat-select [(value)]="tipoNoticia" (selectionChange)="descargarNoticias(tipoNoticia)">
          <mat-option [value]="'noticia'">
            Noticia
          </mat-option>
          <mat-option [value]="'cronica'">
            Crónica
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="row mt-3 ml-3" *ngIf="!editar">
      <mat-card class="col-10 col-sm-10 col-md-5 col-lg-3 col-xl-3 m-3" *ngFor="let noticia of noticiasDescargadas">
        <mat-card-actions>
          <i *ngIf="appComponent.facebookApi" class="fab fa-facebook float-left mr-3 {{noticia.facebook == null ? 'text-danger' : 'text-success'}}" (click)="xarxesSocials(noticia,'facebook')" tooltip="{{noticia.facebook == null ? 'Publicar' : 'Eliminar publicación'}}" [hidden]="true"></i>
          <i *ngIf="appComponent.instagramApi" class="fab fa-instagram float-left mr-3 {{noticia.instagram == null ? 'text-danger' : 'text-success'}}" (click)="xarxesSocials(noticia,'instagram')" tooltip="{{noticia.instagram == null ? 'Publicar' : 'Eliminar publicación'}}" [hidden]="true"></i>
          <i *ngIf="appComponent.twitterApi" class="fab fa-twitter float-left mr-3 {{noticia.twitter == null ? 'text-danger' : 'text-success'}}" (click)="xarxesSocials(noticia,'twitter')" tooltip="{{noticia.twitter == null ? 'Publicar' : 'Eliminar publicación'}}" [hidden]="true"></i>
          <i class="fas fa-trash float-right text-danger" (click)="delete(noticia)"></i>
          <i class="fas fa-pen float-right mr-3 text-primary" (click)="editNoticia = noticia;editar=true;"></i>
        </mat-card-actions>
        <mat-card-header>
          <mat-card-title>{{ noticia.titol }}</mat-card-title>
        </mat-card-header>
        <img mat-card-image src="{{ noticia.imagenPortada }}" alt="{{ noticia.titol }}">
      </mat-card>
      <div *ngIf="msgNoticiesEmpty">No hay resultados</div>
    </div>
    <div class="row mt-3" *ngIf="editar">
      <!-- Select type & Main photo for edition --->
      <div class="col-12 col-sm-12 col-md-12 col-lg-3 col-xl-3">
        <div class="row">
          <div class="col-12 col-sm-12 col-md-6 col-lg-12 col-xl-12">
            <mat-form-field [hidden]="editNoticia.tipo != 'cronica'">
              <mat-label><b>Equipo</b></mat-label>
              <mat-select [(value)]="editNoticia.equipo">
                <mat-option *ngFor="let equipo of equipos" [value]="equipo.id">
                  {{ equipo.categoria }} {{ equipo.tipoCategoria }} {{ equipo.descripcion }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-12 d-none d-lg-block">
            <input [hidden]="true" class="mt-3" type="file" accept="image/*" #file imageUpload (imageSelected)="selected($event)" [resizeOptions]="resizeOptions"/>
            <button type="button" class="btn btn-primary mt-3 mb-3" (click)="file.click()">Cambiar imagen de portada</button>
            <img src="{{ editNoticia.imagenPortada }}" class="max-100"/>
            <div #videoEdit></div>
          </div>
        </div>
      </div>
      <!-- Title & Text editor (Both) -->
      <div class="col-12 col-sm-12 col-md-12 col-lg-9 col-xl-9 mt-3 mt-sm-3 mt-md-3 mt-lg-0 mt-xl-0">
        <div class="row">
          <mat-form-field class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-6">
            <input matInput type="text" maxlength="100" placeholder="Título" #editTitol [value]="editNoticia.titol">
          </mat-form-field>
          <div class="col-12">
            <angular-editor [(ngModel)]="editNoticia.text" [config]="editorConfig"></angular-editor>
          </div>
        </div>
      </div>
      <!-- Main photo for edition (Mobile) -->
      <div class="col-12 d-lg-none">
        <input [hidden]="true" class="mt-3" type="file" accept="image/*" #file imageUpload (imageSelected)="selected($event)" [resizeOptions]="resizeOptions"/>
        <button type="button" class="btn btn-primary mt-3 mb-3" (click)="file.click()">Cambiar imagen de portada</button>
        <img src="{{ editNoticia.imagenPortada }}" class="max-100"/>
        <div #videoEdit></div>
      </div>
      <!-- Media files for edition (Both) -->
      <div class="col-12 mb-3">
        <div class="row">
          <div class="col-12">
            <input [hidden]="true" class="mt-3" type="file" accept="image/*|video/*" #files imageUpload (imageSelected)="insertMedia($event)" [resizeOptions]="resizeOptions" multiple/>
            <button type="button" class="btn btn-primary mt-3 mb-3" (click)="files.click()">Añadir contenido adicional</button>
          </div>
          <div class="col-lg-1 col-4" *ngFor="let m of editNoticia.media">
            <button class="close" (click)="deleteImagen(m)"><i class="fas fa-times-circle"></i></button>
            <img src="{{ m.mediaURL }}" width="100%"/>
          </div>
        </div>
      </div>
      <!-- Button for edition (Both) -->
      <div class="col-12 col-sm-12 col-md-12 col-lg-3 col-xl-3 mt-3">
        <button type="button" class="btn btn-secondary" (click)="editar = false">Cancelar</button>
        <button type="button" class="btn btn-success float-right" [disabled]="editNoticia.imagenPortada === undefined || editNoticia.titol === '' || editNoticia.text === undefined || editNoticia.tipo === undefined || (editNoticia.tipo === 'cronica' && editNoticia.equipo === undefined)" (click)="edit(editNoticia)">Guardar</button>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>
<ngx-spinner
  bdColor = "rgba(51,51,51,0.8)"
  size = "medium"
  color = "#fff"
  type = "ball-climbing-dot"
  [fullScreen] = "true"
>
  <p style="color: white" > {{ spinnerMessage }} </p>
</ngx-spinner>
